# سیستم خدمات پویا - Vista Net

## توضیحات کلی

این سیستم امکان مدیریت خدمات به صورت پویا را فراهم می‌کند. تمام دسته‌بندی‌ها، خدمات و فیلدهای فرم از سرور خوانده می‌شوند و قابل کنترل هستند.

## ویژگی‌های اصلی

### 1. دسته‌بندی‌های پویا

- دسته‌بندی‌ها از سرور خوانده می‌شوند
- هر دسته‌بندی دارای آیکون، عنوان و توضیحات است
- امکان مرتب‌سازی دسته‌بندی‌ها

### 2. خدمات پویا

- هر خدمت در یک دسته‌بندی قرار دارد
- خدمات دارای تنظیمات خاص هستند:
  - نیاز به کد ملی
  - نیاز به کد پرسنلی
  - نیاز به آدرس
  - نیاز به تاریخ تولد
  - نیاز به مدارک
  - هزینه و زمان پردازش

### 3. فیلدهای پویا

هر خدمت می‌تواند فیلدهای سفارشی داشته باشد:

- **متن**: فیلدهای متنی ساده
- **عدد**: فیلدهای عددی
- **ایمیل**: فیلدهای ایمیل با اعتبارسنجی
- **تلفن**: فیلدهای شماره تلفن
- **تاریخ**: انتخابگر تاریخ
- **انتخاب**: لیست کشویی
- **متن چندخطی**: فیلدهای متنی بزرگ
- **چک‌باکس**: فیلدهای بله/خیر
- **فایل**: آپلود فایل

### 4. سیستم تیکت

- ایجاد تیکت برای هر خدمت
- ذخیره فیلدهای پویا در تیکت
- پیگیری وضعیت تیکت‌ها
- آپلود فایل‌های مربوطه

## ساختار دیتابیس

### جداول اصلی

1. **service_categories**: دسته‌بندی‌های خدمات
2. **services**: خدمات با تنظیمات خاص
3. **service_fields**: فیلدهای پویا برای هر خدمت
4. **tickets**: تیکت‌های کاربران
5. **uploaded_files**: فایل‌های آپلود شده

## نحوه استفاده

### 1. تنظیم دسته‌بندی‌ها

```sql
INSERT INTO service_categories (title, description, icon, sort_order) VALUES
('کلیه امور مالیاتی', 'خدمات مربوط به امور مالیاتی', 'account_balance', 1);
```

### 2. ایجاد خدمات

```sql
INSERT INTO services (category_id, title, description, icon, requires_national_id, processing_time_days) VALUES
((SELECT id FROM service_categories WHERE title = 'کلیه امور مالیاتی'), 
'دریافت ابلاغیه مالیات', 'دریافت ابلاغیه‌های مالیاتی', 'gavel', TRUE, 2);
```

### 3. تعریف فیلدهای پویا

```sql
INSERT INTO service_fields (service_id, field_name, field_label, field_type, is_required) VALUES
((SELECT id FROM services WHERE title = 'دریافت ابلاغیه مالیات'),
'company_name', 'نام شرکت', 'text', TRUE);
```

## فایل‌های کلیدی

### مدل‌ها

- `models/service_category_model.dart`: مدل دسته‌بندی
- `models/service_model.dart`: مدل خدمت
- `models/service_field_model.dart`: مدل فیلد پویا
- `models/ticket_model.dart`: مدل تیکت

### سرویس‌ها

- `services/service_api.dart`: API دریافت خدمات
- `services/ticket_service.dart`: مدیریت تیکت‌ها

### صفحات

- `screens/dynamic_services_screen.dart`: صفحه اصلی خدمات
- `screens/service_form_screen.dart`: فرم پویا برای هر خدمت
- `screens/tickets_screen.dart`: مدیریت تیکت‌ها

## مزایای سیستم

1. **انعطاف‌پذیری**: امکان اضافه کردن خدمات جدید بدون تغییر کد
2. **قابلیت کنترل**: تمام تنظیمات از پنل مدیریت قابل کنترل
3. **مقیاس‌پذیری**: امکان اضافه کردن فیلدهای جدید به هر خدمت
4. **کاربری آسان**: رابط کاربری ساده و قابل فهم
5. **امنیت**: استفاده از RLS و احراز هویت Supabase

## مراحل بعدی

1. ایجاد پنل مدیریت برای کنترل خدمات
2. اضافه کردن سیستم اعلان‌ها
3. پیاده‌سازی سیستم پرداخت
4. اضافه کردن گزارش‌گیری
5. بهینه‌سازی رابط کاربری

## نکات مهم

- تمام فیلدهای پویا در JSON ذخیره می‌شوند
- امکان اعتبارسنجی فیلدها وجود دارد
- سیستم از RLS برای امنیت استفاده می‌کند
- فایل‌ها در Supabase Storage ذخیره می‌شوند
